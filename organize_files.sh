#!/bin/bash
# Script d'organisation des fichiers pour GitHub Pages
# Usage: ./organize_files.sh

echo "ðŸ—‚ï¸ Organisation des fichiers pour GitHub Pages..."
echo "================================================"

# CrÃ©er les rÃ©pertoires nÃ©cessaires
mkdir -p docs/data docs/reports docs/visualizations

# Copier les fichiers HTML principaux
echo "ðŸ“‹ Copie des visualisations..."
cp dashboard_velomagg.html docs/ 2>/dev/null || echo "âš ï¸ dashboard_velomagg.html non trouvÃ©"
cp carte_velomagg.html docs/ 2>/dev/null || echo "âš ï¸ carte_velomagg.html non trouvÃ©"
cp temporal_analysis.html docs/ 2>/dev/null || echo "âš ï¸ temporal_analysis.html non trouvÃ©"

# Copier les donnÃ©es
echo "ðŸ“Š Copie des donnÃ©es..."
cp velomagg_analysis.csv docs/data/ 2>/dev/null || echo "âš ï¸ velomagg_analysis.csv non trouvÃ©"
cp velomagg_analysis_stats.json docs/data/ 2>/dev/null || echo "âš ï¸ velomagg_analysis_stats.json non trouvÃ©"

# Copier les rapports
echo "ðŸ“„ Copie des rapports..."
cp rapport_detaille.txt docs/reports/ 2>/dev/null || echo "âš ï¸ rapport_detaille.txt non trouvÃ©"

# Copier les visualisations statiques
echo "ðŸ–¼ï¸ Copie des graphiques..."
if [ -d "visualizations" ]; then
    cp -r visualizations/* docs/visualizations/ 2>/dev/null || echo "âš ï¸ Aucune visualisation trouvÃ©e"
else
    echo "âš ï¸ Dossier visualizations non trouvÃ©"
fi

# CrÃ©er un fichier _config.yml pour GitHub Pages
echo "âš™ï¸ Configuration GitHub Pages..."
cat > docs/_config.yml << EOF
# Configuration GitHub Pages pour VÃ©loMAG Stats
title: "VÃ©loMAG Stats"
description: "Analyse en temps rÃ©el du systÃ¨me de vÃ©los en libre-service de Montpellier"
baseurl: ""
url: "https://$(git config user.name).github.io"

# Jekyll configuration
markdown: kramdown
highlighter: rouge
theme: null

# Exclude files
exclude:
  - README.md
  - LICENSE
  - "*.py"
  - "*.sh"
  - ".venv/"
  - "__pycache__/"

# Include files
include:
  - assets/
  - data/
  - reports/
  - visualizations/

# Plugins
plugins:
  - jekyll-sitemap
  - jekyll-feed

# SEO
lang: fr
author: VÃ©loMAG Analytics
EOF

# CrÃ©er un README pour le dossier docs
cat > docs/README.md << EOF
# VÃ©loMAG Stats - GitHub Pages

Ce dossier contient les fichiers pour le site web GitHub Pages.

## Structure

- \`index.html\` - Page principale du site
- \`assets/\` - CSS, JS et autres ressources
- \`data/\` - Fichiers de donnÃ©es (CSV, JSON)
- \`reports/\` - Rapports texte
- \`visualizations/\` - Graphiques statiques

## Mise Ã  jour

Pour mettre Ã  jour les donnÃ©es du site, exÃ©cutez :

\`\`\`bash
./organize_files.sh
\`\`\`

## Configuration GitHub Pages

1. Aller dans Settings > Pages
2. Source: Deploy from a branch
3. Branch: main
4. Folder: /docs
EOF

# CrÃ©er un .gitignore pour le dossier docs
cat > docs/.gitignore << EOF
# Fichiers temporaires
*.tmp
*.temp
.DS_Store

# Logs
*.log
EOF

# CrÃ©er un index.json pour l'API des donnÃ©es
echo "ðŸ”§ CrÃ©ation de l'index API..."
cat > docs/data/index.json << EOF
{
  "api": {
    "version": "1.0",
    "last_update": "$(date -u +"%Y-%m-%dT%H:%M:%SZ")",
    "endpoints": {
      "csv": "velomagg_analysis.csv",
      "json": "velomagg_analysis_stats.json",
      "reports": "../reports/rapport_detaille.txt",
      "visualizations": "../visualizations/"
    }
  },
  "description": "API des donnÃ©es VÃ©loMAG Stats"
}
EOF

# Afficher la structure finale
echo ""
echo "âœ… Organisation terminÃ©e!"
echo ""
echo "ðŸ“ Structure crÃ©Ã©e:"
echo "docs/"
echo "â”œâ”€â”€ index.html (page principale)"
echo "â”œâ”€â”€ dashboard_velomagg.html"
echo "â”œâ”€â”€ carte_velomagg.html"
echo "â”œâ”€â”€ temporal_analysis.html"
echo "â”œâ”€â”€ assets/"
echo "â”‚   â”œâ”€â”€ css/style.css"
echo "â”‚   â””â”€â”€ js/app.js"
echo "â”œâ”€â”€ data/"
echo "â”‚   â”œâ”€â”€ velomagg_analysis.csv"
echo "â”‚   â”œâ”€â”€ velomagg_analysis_stats.json"
echo "â”‚   â””â”€â”€ index.json"
echo "â”œâ”€â”€ reports/"
echo "â”‚   â””â”€â”€ rapport_detaille.txt"
echo "â””â”€â”€ visualizations/"
echo "    â””â”€â”€ (graphiques PNG)"
echo ""
echo "ðŸš€ Pour activer GitHub Pages:"
echo "1. Aller dans Settings > Pages de votre repo GitHub"
echo "2. Source: Deploy from a branch"  
echo "3. Branch: main"
echo "4. Folder: /docs"
echo ""
echo "ðŸŒ Votre site sera disponible Ã :"
echo "https://$(git config user.name 2>/dev/null || echo "USERNAME").github.io/$(basename $(pwd))"
